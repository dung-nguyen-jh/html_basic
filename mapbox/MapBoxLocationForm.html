<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Autofill suggestions (custom elements)</title>
    <!-- Default styling. Feel free to remove! -->
    <link
      href="https://api.mapbox.com/mapbox-assembly/v1.3.0/assembly.min.css"
      rel="stylesheet"
    />
    <script
      id="search-js"
      defer=""
      src="https://api.mapbox.com/search-js/v1.0.0-beta.18/web.js"
    ></script>
  </head>
  <body>
    <form class="prose flex flex--column">
      <h3>Shipping</h3>
      <mapbox-address-autofill>
        <input
          class="input mb12"
          name="address"
          autocomplete="shipping address-line1"
          placeholder="Address"
        />
      </mapbox-address-autofill>

      <input
        class="input mb12"
        name="apartment"
        autocomplete="shipping address-line2"
        placeholder="Apartment"
      />
      <div class="flex">
        <input
          class="input mb12"
          name="city"
          autocomplete="shipping address-level2"
          placeholder="City"
        />
        <input
          class="input mb12 ml6"
          name="state"
          autocomplete="shipping address-level1"
          placeholder="State"
        />
        <input
          class="input mb12 ml6"
          autocomplete="shipping postal-code"
          placeholder="ZIP / Postcode"
        />
      </div>

    </form>
    <script>
      const ACCESS_TOKEN =
        "pk.eyJ1IjoidGhpbmhsZTk5IiwiYSI6ImNsdHd1M3RjejAxYmwyaXBvbWRvN3VldW0ifQ.u_n9TO0Rr00-a65HjZ-0Fw";

      const script = document.getElementById("search-js");
      script.onload = () => {
        const elements = document.querySelectorAll("mapbox-address-autofill");
        for (const autofill of elements) {
          autofill.accessToken = ACCESS_TOKEN;
        }
      };
    </script>
  </body>
</html>

map.on("click", function (event) {
  // Retrieve the coordinates where the user clicked
  let lngLat = event.lngLat;

  // Check if a marker was clicked
  let features = map.queryRenderedFeatures(event.point, {
    layers: ["markers"],
  });

  // If a marker was clicked, remove it
  if (features.length) {
    let markerId = features[0].properties.markerId;
    let marker = markers[markerId];
    marker.remove();
    delete markers[markerId];
  } else {
    // Otherwise, add a marker at the clicked location
    let msg = prompt("Enter a message for the marker");
    if (msg) addMarker(lngLat, msg);
  }
});

// Function to add a marker at the specified coordinates
function addMarker(lngLat, msg) {
  popup = new mapboxgl.Popup({ offset: 25 })
    .setHTML("<h3>Marker</h3><p>" + msg + "</p>")
    .addTo(map);

  let marker = new mapboxgl.Marker().setLngLat(lngLat).addTo(map);

  marker.getElement().addEventListener("click", function (event) {
    // alert('You clicked on the marker');
    marker.togglePopup();
    event.stopPropagation();
  });
